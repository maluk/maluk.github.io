services:
  agent:
    build:
      context: ./repo/maluk.github.io
      target: agent
    user: "1000:1000"
    restart: unless-stopped
    environment:
      - ANTHROPIC_API_KEY
      - LOG_LEVEL=INFO
      - AGENT_CWD=/home/agent/repository
      - AGENT_WORKTREES_DIR=/home/agent/workspaces
      - AGENT_SETUP_CMD=npm install
      - AGENT_TEST_CMD=npm run build
      - AGENT_MAX_CONCURRENT=2
      - AGENT_TIMEOUT=7200
      # - AGENT_MERGE_QUEUE_LIST=merge queue
      - GIT_AUTHOR_NAME=Kardbrd Agent
      - GIT_AUTHOR_EMAIL=agent@example.com
      - GIT_COMMITTER_NAME=Kardbrd Agent
      - GIT_COMMITTER_EMAIL=agent@example.com
    volumes:
      # Subscription state (persisted across restarts)
      - ./.kardbrd/state:/app/state
      # Base repository (read-write)
      - ./repo/maluk.github.io:/home/agent/repository
      # Worktrees (separate from repo)
      - ./.kardbrd/workspaces:/home/agent/workspaces
      # Claude CLI home (API creds, session data, settings)
      - ./.kardbrd/claude:/home/agent/.claude
      # SSH key (read-only) â€” use a DEDICATED key, not personal
      - ./.kardbrd/ssh/id_ed25519:/home/agent/.ssh/id_ed25519:ro
