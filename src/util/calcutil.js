const w = {
     '2021' : {
         s : { // Single
             deduction : 12550,
             brackets : {
                0 : { p : 0.1, s : 0 },
                9950 : { p : 0.12, s : 995 },
                40525 : { p : 0.22, s : 4664 },
                86375 : { p : 0.24, s : 14751 },
                164925 : { p : 0.32, s : 33603 },
                209425 : { p : 0.35, s : 47843 },
                523600 : { p : 0.37, s : 157804.25 },
                999999999 : { p : 0.37, s : 0 }
             }
         },
         m : { // Married
             deduction : 25100,
             brackets : {
                0 : { p : 0.1, s : 0 },
                19900 : { p : 0.12, s : 1990 },
                81050 : { p : 0.22, s : 9328 },
                172750 : { p : 0.24, s : 29502 },
                329850 : { p : 0.32, s : 67206 },
                418850 : { p : 0.35, s : 95686 },
                628300 : { p : 0.37, s : 168993.5 },
                999999999 : { p : 0.37, s : 0 }
             }
         }
     },
"2022": {
  "s": {
    "deduction": 12950,
    "brackets": {
      "0": {
        "p": 0.1,
        "s": 0.0
      },
      "10275": {
        "p": 0.12,
        "s": 1027.5
      },
      "41775": {
        "p": 0.22,
        "s": 4807.5
      },
      "89075": {
        "p": 0.24,
        "s": 15213.5
      },
      "170050": {
        "p": 0.32,
        "s": 34647.5
      },
      "215950": {
        "p": 0.35,
        "s": 49335.5
      },
      "539900": {
        "p": 0.37,
        "s": 162718.0
      }
    }
  },
  "m": {
    "deduction": 25900,
    "brackets": {
      "0": {
        "p": 0.1,
        "s": 0.0
      },
      "20550": {
        "p": 0.12,
        "s": 2055.0
      },
      "83550": {
        "p": 0.22,
        "s": 9615.0
      },
      "178150": {
        "p": 0.24,
        "s": 30427.0
      },
      "340100": {
        "p": 0.32,
        "s": 69295.0
      },
      "431900": {
        "p": 0.35,
        "s": 98671.0
      },
      "647850": {
        "p": 0.37,
        "s": 174253.5
      }
    }
  }
}
}

const s = {
  "2021": {
    "s": {
      "deduction": 4803,
      "brackets": {
        "0": {
          "p": 0.01,
          "s": 0.0
        },
        "9325": {
          "p": 0.02,
          "s": 93.25
        },
        "22107": {
          "p": 0.04,
          "s": 348.89
        },
        "34892": {
          "p": 0.06,
          "s": 860.29
        },
        "48435": {
          "p": 0.08,
          "s": 1672.87
        },
        "61214": {
          "p": 0.093,
          "s": 2695.19
        },
        "312686": {
          "p": 0.103,
          "s": 26082.09
        },
        "375221": {
          "p": 0.113,
          "s": 32523.2
        },
        "625369": {
          "p": 0.123,
          "s": 60789.92
        },
        "1000000": {
          "p": 0.133,
          "s": 106869.53
        }
      }
    },
    "m": {
      "deduction": 9606,
      "brackets": {
        "0": {
          "p": 0.01,
          "s": 0.0
        },
        "18650": {
          "p": 0.02,
          "s": 186.5
        },
        "44214": {
          "p": 0.04,
          "s": 697.78
        },
        "69784": {
          "p": 0.06,
          "s": 1720.58
        },
        "96870": {
          "p": 0.08,
          "s": 3345.74
        },
        "122428": {
          "p": 0.093,
          "s": 5390.38
        },
        "625372": {
          "p": 0.103,
          "s": 52164.17
        },
        "750442": {
          "p": 0.113,
          "s": 65046.38
        },
        "1000000": {
          "p": 0.123,
          "s": 93246.43
        },
        "1250738": {
          "p": 0.133,
          "s": 124087.2
        }
      }
    }
  },
  "2022": {
  "s": {
    "deduction": 4803,
    "brackets": {
      "0": {
        "p": 0.01,
        "s": 0.0
      },
      "9325": {
        "p": 0.02,
        "s": 93.25
      },
      "22107": {
        "p": 0.04,
        "s": 348.89
      },
      "34892": {
        "p": 0.06,
        "s": 860.29
      },
      "48435": {
        "p": 0.08,
        "s": 1672.87
      },
      "61214": {
        "p": 0.093,
        "s": 2695.19
      },
      "312686": {
        "p": 0.103,
        "s": 26082.09
      },
      "375221": {
        "p": 0.113,
        "s": 32523.2
      },
      "625369": {
        "p": 0.123,
        "s": 60789.92
      },
      "1000000": {
        "p": 0.133,
        "s": 106869.53
      }
    }
  },
  "m": {
    "deduction": 9606,
    "brackets": {
      "0": {
        "p": 0.01,
        "s": 0.0
      },
      "18650": {
        "p": 0.02,
        "s": 186.5
      },
      "44214": {
        "p": 0.04,
        "s": 697.78
      },
      "69784": {
        "p": 0.06,
        "s": 1720.58
      },
      "96870": {
        "p": 0.08,
        "s": 3345.74
      },
      "122428": {
        "p": 0.093,
        "s": 5390.38
      },
      "625372": {
        "p": 0.103,
        "s": 52164.17
      },
      "750442": {
        "p": 0.113,
        "s": 65046.38
      },
      "1000000": {
        "p": 0.123,
        "s": 93246.43
      },
      "1250738": {
        "p": 0.133,
        "s": 124087.2
      }
    }
  }
}
}
const calculateProressive = (taxes, g, status, year) => {
    const yearp = taxes[year];

    var taxableAmount = g - yearp[status].deduction;
    const taxableAmountCopy = taxableAmount;

    if (taxableAmount < 0) {
        return {tax: 0, taxableAmount: 0};
    }

    const yearw = yearp[status].brackets;

    var b = Object.keys(yearw);;

    for (var i = 0; i < b.length; i++) { // Find bracket
        if (b[i] > taxableAmount || b[i] == 999999999)  {
            taxableAmount -= b[i-1]; // Get taxable income
            b = yearw[b[i-1]]; // Set bracket
            var tax = ((b.p*(taxableAmount)) + b.s);
            return {tax: Math.round(tax), taxableAmount: taxableAmountCopy};
        }
    }

    var i = b.length - 1;
    taxableAmount -= b[i-1]; // Get taxable income
    b = yearw[b[i-1]]; // Set bracket
    var tax = ((b.p*(taxableAmount)) + b.s);
    return {tax: Math.round(tax), taxableAmount: taxableAmountCopy};
}

const calculateFed = (g, status, year) => {
    return calculateProressive(w, g, status, year);
}

const calculateState = (g, status, year) => {
    return calculateProressive(s, g, status, year);
}

const calculateSocial = (g, status, year) => {
    const rate = 0.062;
    const cap = 132900;
    const taxableAmount = Math.min(g, cap);

    return Math.round(taxableAmount * rate);
}

const calculateMedicare = (g, status, year) => {
    const rateThreshold = 200000;

    return Math.round(Math.max(0, g - rateThreshold) * 0.009 + Math.min(rateThreshold, g) * 0.0145);
}

export const calculate = (g, status, year, state) => {
    const fed = calculateFed(g, status, year)
    const stateTax = calculateState(g, status, year)
    const socialTax = calculateSocial(g, status, year)
    const medicareTax = calculateMedicare(g, status, year)

    const totalTax = fed.tax + stateTax.tax + socialTax + medicareTax;

    return {
        fed : fed,
        state: stateTax,
        social : socialTax,
        medicare: medicareTax,
        totals: {
            net: g - totalTax,
            netMonthly: Math.round((g - totalTax) / 12),
            tax: totalTax
        }
    };
}
